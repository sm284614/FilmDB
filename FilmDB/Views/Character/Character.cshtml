@using FilmDB.Models
@model IEnumerable<CharacterCount>
@{
    ViewData["Title"] = "Film Characters";
}
<div class="container" style="border-width:1px; border-color:black">
    <div class="d-flex justify-content-between align-items-center">
        <h1>Film Characters</h1>
        <form id="characterSearchForm" class="d-flex">
            <input type="text" id="characterSearchQuery" name="characterSearchQuery" class="form-control me-2" placeholder="Search Characters" required />
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
    
    @if (Model != null && Model.Any())
    {
        <div id="wordCloudContainer" class="mt-4">
            <h3>Iconic Characters</h3>
            <p class="text-muted">Click any character to view details</p>
            <canvas id="characterCloud" style="width: 100%; height: 400px; border: 1px solid #dee2e6; border-radius: 8px;"></canvas>
        </div>
        <!-- Hidden data for JavaScript -->
        <script id="characterData" type="application/json">
            @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
                Model.Select(cc => new { 
                    text = cc.Character.Name, 
                    weight = cc.Count,
                    characterId = cc.Character.CharacterId 
                })
            ))
        </script>
    }
    <div id="characterTableContainer" class="contentTable mt-4">
        <!-- Search results will appear here -->
    </div>
</div>

<script src="~/lib/wordcloud2.min.js"></script>
<script src="~/js/wordCloud.js"></script>

<style>
    #characterCloud {
        cursor: default;
    }
    
    #wordCloudContainer {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
    }
    
    #characterTableContainer:empty {
        display: none;
    }

    .container {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    #characterTableContainer {
        flex: 1 1 auto;
        min-height: 0;
        overflow-y: auto;
    }
</style>